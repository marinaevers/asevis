{"version":3,"sources":["webpack:///./src/lib/components/d3BrushableHeatmap.js"],"names":["HeatmapD3","el","props","update","bind","wrappedClick","margin","top","right","bottom","left","width","height","d3","selectAll","remove","svg","append","attr","isBrushed","brush_coords","cx","cy","w","h","x0","x1","y0","y1","bottomLeftX","Math","max","bottomLeftY","topRightX","min","topRightY","updateBrush","event","extent","selection","cells","style","d","unitSizeX","dimensions","id","unitSizeY","scaleX","x","scaleY","y","push","setProps","redraw","g","cols","data","columns","sort","rows","domain","length","range","axX","fontSize","call","xLabel","text","axY","yLabel","mouseover","mousemove","object","plotWidth","plotHeight","yMaxHist","i","histValues","val","html","value","pageX","pageY","tooltipSvg","xBars","map","padding","tickValues","filter","console","log","tickFormat","histLabel","yBars","enter","bandwidth","mouseleave","minValue","values","maxValue","forEach","e","colorScale","legendProps","title","valueLabel","tickSize","marginTop","marginRight","marginBottom","marginLeft","ticks","ramp","color","n","canvas","document","createElement","context","getContext","fillStyle","fillRect","copy","rangeRound","toDataURL","legendTitle","select","brush","on","calculateDimensions","setBrush","ctrlKey","move","clickX","clickY","showPoints","points","altKey","clear","shiftKey","selectedId","dd","calculateSizes","a","cellSize","b","calculateWidth","l","r","o","calculateHeight","t","maxVal","minVal","dims"],"mappings":"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","file":"d939a7d-main-wps-hmr.js","sourcesContent":["// d3Heatmap.js\nimport * as d3 from 'd3'\nimport {ifElse} from \"ramda\";\n\nexport default class HeatmapD3 {\n    constructor(el, props) {\n        this.update = this.update.bind(this);\n        this.wrappedClick = this.wrappedClick.bind(this);\n        this.props = props\n\n        var margin = {top: 30, right: 100, bottom: 50, left: 50}, width = props.width - margin.left - margin.right,\n            height = props.height - margin.top - margin.bottom;\n\n        this.width = width;\n        this.height = height;\n\n        d3.select(el).selectAll(\"*\").remove();\n\n        // Add drawing area\n        this.svg = d3.select(el).append('svg')\n            .attr('width', width + margin.left + margin.right)\n            .attr('height', height + margin.top + margin.bottom)\n            .append('g')\n            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n\n        // Add brushing\n        var isBrushed = (brush_coords, cx, cy, w, h) => {\n            var x0 = brush_coords[0][0], x1 = brush_coords[1][0], y0 = brush_coords[0][1], y1 = brush_coords[1][1]\n            // selects if there is an intersection\n            var bottomLeftX = Math.max(cx, x0), bottomLeftY = Math.max(cy, y0), topRightX = Math.min(cx + w, x1),\n                topRightY = Math.min(cy + h, y1);\n            return (bottomLeftX <= topRightX && bottomLeftY <= topRightY);\n        };\n\n        var updateBrush = (event) => {\n            var extent = event.selection;\n            if (extent) {\n                var selection = []\n                this.cells.style(\"opacity\", function (d) {\n                    var w = unitSizeX * (dimensions[d.id][0] + dimensions[d.id][1]);\n                    var h = unitSizeY * (dimensions[d.id][2] + dimensions[d.id][3]);\n                    if (isBrushed(extent, scaleX(d.x - dimensions[d.id][0]), scaleY(d.y + dimensions[d.id][3]), w, h)) {\n                        selection.push(d.id)\n                        return 1;\n                    } else {\n                        return 0.5;\n                    }\n                })\n                props.setProps({selection: selection, redraw: false});\n            } else {\n                this.cells.style(\"opacity\", 1)\n            }\n        }\n\n        var g = this.svg.append(\"g\");\n\n        // Draw axes\n        var cols = props.data.columns.sort(d3.ascending)\n        var rows = props.data.rows.sort(d3.ascending)\n        var scaleX = d3.scaleLinear()\n            .domain([cols[0], cols[cols.length - 1]])\n            .range([0, width])\n        this.axX = this.svg.append('g')\n            .style(\"font\", props.fontSize + \"px times\")\n            .attr('transform', 'translate(0,' + height + ')')\n            .call(d3.axisBottom(scaleX));\n        this.xLabel = this.axX.append('text')\n            .attr('x', 0.5 * width)\n            .attr('y', 0.8 * margin.bottom)\n            .attr(\"text-anchor\", \"middle\")\n            .attr(\"fill\", \"black\")\n            .attr(\"font-size\", props.fontSize)\n            .text(props.xLabel);\n        var scaleY = d3.scaleLinear()\n            .domain([rows[0], rows[rows.length - 1]])\n            .range([height, 0])\n        this.axY = this.svg.append('g')\n            .style(\"font\", props.fontSize + \"px times\")\n            .call(d3.axisLeft(scaleY));\n        this.yLabel = this.axY.append('text')\n            .attr(\"transform\", \"rotate(-90)\")\n            .attr('x', -0.5 * height)\n            .attr('y', -0.8 * margin.bottom)\n            .attr(\"text-anchor\", \"middle\")\n            .attr(\"fill\", \"black\")\n            .attr(\"font-size\", props.fontSize)\n            .text(props.yLabel);\n\n        // Three function that change the tooltip when user hover / move / leave a cell\n        var mouseover = function (d) {\n            d3.select(\".tooltip\").style(\"opacity\", 1);\n        }\n        var mousemove = function (d, object) {\n            var plotWidth = 250;\n            var plotHeight = 130;\n            var yMaxHist = 0;\n            for (let i = 0; i < object.histValues.length; ++i) {\n                const val = object.histValues[i][1];\n                if (val > yMaxHist) {\n                    yMaxHist = val;\n                }\n            }\n            d3.select(\".tooltip\")\n                .html(object.x + \",\" + object.y + \"<br>Value: \" + object.value + \"<br><div id='tipDistribution'></div>\")\n                .style(\"left\", (d.pageX + 10) + \"px\")\n                .style(\"top\", (d.pageY + 10) + \"px\");\n            var tooltipSvg = d3.select(\"#tipDistribution\")\n                .append(\"svg\")\n                .attr(\"width\", plotWidth + 40)\n                .attr(\"height\", plotHeight + 40)\n            var xBars = d3.scaleBand()\n                .range([0, plotWidth])\n                .domain(object.histValues.map(function (d) {\n                    return d[0];\n                }))\n                .padding(0.05);\n            tooltipSvg.append(\"g\")\n                .attr(\"transform\", \"translate(30,\" + plotHeight + \")\")\n                .call(d3.axisBottom(xBars)\n                    .tickValues(xBars.domain().filter(function (d, i) {\n                        console.log(d);\n                        return !(i % 5)\n                    }))\n                .tickFormat(function (d) {\n                    return d3.format(\".2f\")(d);\n                }))\n                .append(\"text\")\n                .attr(\"text-anchor\", \"middle\")\n                .attr(\"fill\", \"black\")\n                .attr(\"x\", plotWidth / 2)\n                .attr(\"y\", 30)\n                .text(props.histLabel);\n            var yBars = d3.scaleLinear()\n                .domain([0, yMaxHist])\n                .range([plotHeight, 0]);\n            tooltipSvg.append(\"g\")\n                .attr(\"transform\", \"translate(30,5)\")\n                .call(d3.axisLeft(yBars));\n            tooltipSvg.selectAll(\"histBars\")\n                .data(object.histValues)\n                .enter()\n                .append(\"rect\")\n                .attr(\"x\", function (d) {\n                    return xBars(d[0]) + 30\n                })\n                .attr(\"y\", function (d) {\n                    return yBars(d[1])\n                })\n                .attr(\"width\", xBars.bandwidth())\n                .attr(\"height\", function (d) {\n                    return plotHeight - yBars(d[1])\n                })\n                .attr(\"fill\", \"#8a8a8a\");\n        }\n        var mouseleave = function (d) {\n            d3.select(\".tooltip\").style(\"opacity\", 0);\n        }\n\n        var minValue = props.data.values[0].value\n        var maxValue = props.data.values[0].value\n        props.data.values.forEach(e => {\n            if (e.value < minValue) {\n                minValue = e.value\n            }\n            if (e.value > maxValue) {\n                maxValue = e.value\n            }\n        })\n\n        // Add color scale\n        var colorScale = d3.scaleSequential(d3.interpolateViridis)\n            .domain([maxValue, minValue])\n\n        // Color bar\n        const legendProps = {\n            title: props.valueLabel, tickSize: 6, width: 30, height: props.height - margin.top - margin.bottom,// + tickSize,\n            marginTop: 0, marginRight: 0, marginBottom: 0,// + tickSize,\n            marginLeft: 10, ticks: width / 64\n        };\n\n        function ramp(color, n = 256) {\n            const canvas = document.createElement(\"canvas\");\n            canvas.width = 1;\n            canvas.height = n;\n            const context = canvas.getContext(\"2d\");\n            for (let i = 0; i < n; ++i) {\n                context.fillStyle = color(i / (n - 1));\n                context.fillRect(0, n - 1 - i, 1, 1);\n            }\n            return canvas;\n        }\n\n        const n = Math.min(colorScale.domain().length, colorScale.range().length)\n        let x = colorScale.copy().rangeRound(d3.quantize(d3.interpolate(legendProps.marginTop, legendProps.height - legendProps.marginBottom), n));\n        this.svg.append(\"image\")\n            .attr(\"x\", width + legendProps.marginLeft)\n            .attr(\"y\", legendProps.marginTop)\n            .attr(\"width\", legendProps.width - legendProps.marginLeft - legendProps.marginRight)\n            .attr(\"height\", legendProps.height - legendProps.marginTop - legendProps.marginBottom)\n            .attr(\"preserveAspectRatio\", \"none\")\n            .attr(\"xlink:href\", ramp(colorScale.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL());\n        this.legendTitle = this.svg.append(\"g\")\n            .style(\"font\", props.fontSize + \"px times\")\n            .attr(\"transform\", 'translate(' + (width + legendProps.width) + ',0)')\n            .call(d3.axisRight(x))\n            .call(g => g.select(\".domain\").remove())\n            .append(\"text\")\n            .attr(\"x\", -legendProps.width + legendProps.marginLeft)\n            .attr(\"y\", -5)\n            .attr(\"fill\", \"black\")\n            .attr(\"text-anchor\", \"start\")\n            .attr(\"font-size\", props.fontSize)\n            .text(legendProps.title);\n\n        colorScale = d3.scaleSequential(d3.interpolateViridis)\n            .domain([minValue, maxValue])\n\n        this.brush = d3.brush()\n            .extent([[0, 0], [this.width, this.height]])\n            .on(\"end\", updateBrush)\n        this.svg.append(\"g\")\n            .attr(\"class\", \"brush\")\n            .call(this.brush)\n\n        // draw cells\n        //var cellSizeX = calculateSizes(cols);\n        //var cellSizeY = calculateSizes(rows);\n        var dimensions = calculateDimensions(props.data.values);\n        var unitSizeX = width / (cols[cols.length - 1] - cols[0]);\n        var unitSizeY = height / (rows[rows.length - 1] - rows[0]);\n        this.cells = this.svg.selectAll('.cell')\n            .data(props.data.values)\n            .enter().append('g')\n\n        var setBrush = (d) => {\n            if (d.ctrlKey) {\n                const [[cx, cy]] = d3.pointers(d);\n                this.brush.move(d3.select(\".brush\"),\n                    [[this.clickX, this.clickY], [cx, cy]]);\n            }\n        }\n        this.cells.append('rect')\n            .attr('class', 'cell')\n            .attr('width', function (d) {\n                return unitSizeX * (dimensions[d.id][0] + dimensions[d.id][1])\n            })\n            .attr('height', function (d) {\n                return unitSizeY * (dimensions[d.id][2] + dimensions[d.id][3])\n            })\n            .attr('y', function (d) {\n                return scaleY(d.y + dimensions[d.id][3])\n            })\n            .attr('x', function (d) {\n                return scaleX(d.x - dimensions[d.id][0])\n            })\n            .attr('fill', function (d) {\n                return colorScale(d.value)\n            })\n            .attr('value', function (d) {\n                return d.value\n            })\n            .attr('dataID', function (d) {\n                return d.id;\n            })\n            .attr('pointer-events', 'all')\n            .on(\"mouseover\", mouseover)\n            .on(\"mousemove\", mousemove)\n            .on(\"mouseleave\", mouseleave)\n            .on(\"mousedown\", this.wrappedClick)\n            .on(\"mouseup\", setBrush)\n        if (props.showPoints) {\n            this.points = this.cells.append(\"circle\")\n                .attr('cx', function (d) {\n                    return scaleX(d.x)\n                })\n                .attr('cy', function (d) {\n                    return scaleY(d.y)\n                })\n                .attr('r', 5)\n                .style('fill', 'black')\n        }\n\n        d3.select(el)\n            .append(\"div\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"tooltip\")\n            .style(\"background-color\", \"white\")\n            .style(\"border\", \"solid\")\n            .style(\"border-width\", \"2px\")\n            .style(\"border-radius\", \"5px\")\n            .style(\"padding\", \"5px\")\n            .style(\"position\", \"absolute\")\n    }\n\n    wrappedClick(d, object) {\n        if (d.altKey) {\n            this.brush.clear(d3.select(\".brush\"));\n        }\n        if (d.shiftKey) {\n            this.props.setProps({selectedId: object.id, redraw: false});\n            this.points.style('fill', function (dd) {\n                if (dd.id === object.id) {\n                    return \"red\";\n                } else {\n                    return \"black\";\n                }\n            })\n        }\n        const [[cx, cy]] = d3.pointers(d);\n        this.clickX = cx;\n        this.clickY = cy;\n\n    }\n\n    update(props) {\n        this.legendTitle\n            .text(props.valueLabel);\n    }\n\n}\n\nconst calculateSizes = (a) => {\n    var cellSize = {}\n    cellSize[a[0]] = {\n        left: 0, right: 0.5 * (a[1] - a[0])\n    }\n    for (let i = 1; i < a.length - 1; i++) {\n        cellSize[a[i]] = {\n            left: 0.5 * (a[i] - a[i - 1]), right: 0.5 * (a[i + 1] - a[i])\n        }\n    }\n    cellSize[a[a.length - 1]] = {\n        left: 0.5 * (a[a.length - 1] - a[a.length - 2]), right: 0,\n    }\n    return cellSize;\n}\n\nconst min = (a, b) => {\n    if (a < b) {\n        return a;\n    } else {\n        return b;\n    }\n}\n\nconst max = (a, b) => {\n    if (a > b) {\n        return a;\n    } else {\n        return b;\n    }\n}\n\nconst calculateWidth = (d, data) => {\n    var l = 10;\n    var r = 10;\n    for (let i = 0; i < data.length; i++) {\n        var o = data[i]\n        if (d.x !== o.x) {\n            if (o.x < d.x) {\n                l = min(l, (d.x - o.x));\n            } else {\n                r = min(r, o.x - d.x);\n            }\n        }\n    }\n    if (l === 10) {\n        l = 0;\n    }\n    if (r === 10) {\n        r = 0;\n    }\n    return [0.5 * l, 0.5 * r];\n}\n\nconst calculateHeight = (d, data) => {\n    var b = 10;\n    var t = 10;\n    var maxVal = 0;\n    var minVal = 10;\n    for (let i = 0; i < data.length; i++) {\n        var o = data[i];\n        minVal = min(minVal, o.y);\n        maxVal = max(maxVal, o.y);\n        if (d.y !== o.y && d.x === o.x) {\n            if (o.y < d.y) {\n                b = min(b, (d.y - o.y));\n            } else {\n                t = min(t, o.y - d.y);\n            }\n        }\n    }\n    if (t === 10) {\n        t = (maxVal - d.y) * 2;\n    }\n    if (b === 10) {\n        b = (d.y - minVal) * 2;\n    }\n    return [0.5 * b, 0.5 * t];\n}\n\nconst calculateDimensions = (data) => {\n    var dims = {};\n    for (let i = 0; i < data.length; i++) {\n        var d = data[i];\n        var l, r, b, t;\n        [l, r] = calculateWidth(d, data);\n        [b, t] = calculateHeight(d, data);\n        dims[d.id] = [l, r, b, t];\n    }\n    return dims;\n}"],"sourceRoot":""}